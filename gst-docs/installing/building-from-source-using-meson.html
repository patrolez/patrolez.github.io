<!DOCTYPE html>
<html lang="en">
<head>

<base href="..">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Building from source using Meson</title>

<link rel="stylesheet" href="assets/css/dark-frontend.css" type="text/css" title="dark">
<link rel="alternate stylesheet" href="assets/css/light-frontend.css" type="text/css" title="light">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/extra_frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/devhelp.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css" title="dark">

<link rel="alternate stylesheet" href="assets/css/prism.css" type="text/css" title="light">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>
<script src="assets/js/styleswitcher.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/trie.js"></script>

<!-- generic -->
<link rel="icon" type="image/png" href="assets/images/favicon-16.png" sizes="16x16">
<link rel="icon" type="image/png" href="assets/images/favicon-32.png" sizes="32x32">
<link rel="icon" type="image/png" href="assets/images/favicon-57.png" sizes="57x57">
<link rel="icon" type="image/png" href="assets/images/favicon-64.png" sizes="64x64">
<link rel="icon" type="image/png" href="assets/images/favicon-76.png" sizes="76x76">
<link rel="icon" type="image/png" href="assets/images/favicon-96.png" sizes="96x96">
<link rel="icon" type="image/png" href="assets/images/favicon-128.png" sizes="128x128">
<link rel="icon" type="image/png" href="assets/images/favicon-192.png" sizes="192x192">
<link rel="icon" type="image/png" href="assets/images/favicon-228.png" sizes="228x228">

<!-- Android -->
<link rel="shortcut icon" sizes="196x196" href="assets/images/favicon-196.png">

<!-- iOS -->
<link rel="apple-touch-icon" href="assets/images/favicon-120.png" sizes="120x120">
<link rel="apple-touch-icon" href="assets/images/favicon-152.png" sizes="152x152">
<link rel="apple-touch-icon" href="assets/images/favicon-180.png" sizes="180x180">

</head>

<body class="no-script
">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<span title="light mode switch" class="glyphicon glyphicon-sunglasses pull-right" id="lightmode-icon"></span>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/gstreamer-logo.svg" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
    <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        API References<span class="caret"></span>
    </a>
	<ul class="dropdown-menu" id="modules-menu">
					<li>
				<a href="gstreamer/gi-index.html">GStreamer core</a>
			</li>
					<li>
				<a href="libs.html">GStreamer Libraries</a>
			</li>
					<li>
				<a href="plugins_doc.html">GStreamer Plugins</a>
			</li>
		</ul>
</li>

<li>
    <a href="application-development/index.html">Application manual</a>
</li>


<li>
    <a href="tutorials/index.html">Tutorials</a>
</li>

			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
							</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="gi-extension" data-hotdoc-in-toplevel="True" data-hotdoc-project="GStreamer" data-hotdoc-ref="installing/building-from-source-using-meson.html" class="page_container" id="page-wrapper" data-hotdoc-meta-gi-languages="['c', 'javascript', 'python']" data-hotdoc-meta-gi-language="c">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/full-width.js"></script>
  <div id="sitenav-wrapper">
    <iframe src="hotdoc-sitemap.html" id="sitenav-frame"></iframe>
  </div>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="building-from-source-using-meson">Building from source using Meson</h1>
<p><strong>If you just want to use GStreamer, please visit <a href="https://gstreamer.freedesktop.org/download/">the download page</a>.
We provide pre-built binaries for Windows, macOS, Android, and iOS</strong>.</p>
<p>This is the recommended setup for developers who want to work on the GStreamer
code itself and/or modify it, or application developers who wish to quickly try a
feature which isn't yet in a released version of GStreamer.</p>
<p>Note: This only applies for doing GStreamer development on Linux, Windows and
macOS. If you:</p>
<ol>
<li>Want to do GStreamer development for Android, iOS, or UWP, or</li>
<li>Have to build GStreamer packages for distribution or deployment, or</li>
<li>Need plugins with external dependencies without Meson ports</li>
</ol>
<p>Please refer to <a href="installing/building-from-source-using-cerbero.html">Building using Cerbero</a>,
which can be used to build a specific GStreamer release or to build unreleased
GStreamer code.</p>
<h2 id="what-are-meson-gstbuild-and-the-gstreamer-monorepo">What are Meson, gst-build and the GStreamer monorepo?</h2>
<p>The <a href="https://mesonbuild.com/">Meson build system</a> is a portable build system which is fast and
meant to be more user friendly than alternatives. It generates build
instructions which can then be executed by <a href="https://ninja-build.org/"><code>ninja</code></a>. The GStreamer
project uses it for all subprojects.</p>
<p>In September 2021 all of the main GStreamer modules were merged into a
single code repository, the GStreamer <a href="https://gstreamer.freedesktop.org/documentation/frequently-asked-questions/mono-repository.html">mono repo</a> which lives
in the main <a href="https://gitlab.freedesktop.org/gstreamer/gstreamer/">GStreamer git repository</a>, and this is where all
GStreamer development happens nowadays for GStreamer version 1.19/1.20 and later.</p>
<p>Before the mono repository merge the different GStreamer modules lived in
separate git repositories and there was a separate meta-builder project
called <a href="https://gitlab.freedesktop.org/gstreamer/gst-build/"><code>gst-build</code></a> to download and build all the subprojects.
This is what you should use if you want to build or develop against older
stable branches such as GStreamer 1.16 or 1.18.</p>
<p>If you want to build or develop against upcoming development or stable branches
you should use the <code>main</code> branch of the GStreamer module containing the mono
repository.</p>
<p>In the following sections we will only talk about the GStreamer mono repo,
but <code>gst-build</code> works pretty much the same way, the only difference being
that it would download the various GStreamer submodules as well.</p>
<h2 id="setting-up-the-build-with-meson">Setting up the build with Meson</h2>
<p>In order to build the current GStreamer development version, which will become
the 1.20 stable branch in the near future, clone the GStreamer mono repository:</p>
<pre><code class="language-shell">git clone https://gitlab.freedesktop.org/gstreamer/gstreamer.git
cd gstreamer
</code></pre>
<p>Or if you have developer access to the repositories:</p>
<pre><code class="language-shell">git clone git@gitlab.freedesktop.org:gstreamer/gstreamer.git
cd gstreamer
</code></pre>
<p>If you want to build the stable 1.18 or 1.16 branches, clone <code>gst-build</code>:</p>
<pre><code class="language-shell">git clone https://gitlab.freedesktop.org/gstreamer/gst-build.git
cd gst-build
</code></pre>
<h3 id="repository-layout">Repository layout</h3>
<p>The repository contains a few notable scripts and directories:</p>
<ol>
<li>
<code>meson.build</code> is the top-level build definition which will recursively
configure all dependencies. It also defines some helper commands allowing you
to have a development environment or easily update git
repositories for the GStreamer modules.</li>
<li>
<code>subprojects/</code> is the directory containing GStreamer modules and
a selection of dependencies.</li>
</ol>
<h2 id="basic-meson-and-ninja-usage">Basic meson and ninja usage</h2>
<p>Configuring a module (or several in one go when in gst-build) is done by
executing:</p>
<pre><code class="language-shell">meson setup &lt;build_directory&gt;
</code></pre>
<p>The <code>build_directory</code> is where all the build instructions and output will be
located (This is also called <em>"out of directory"</em> building). If the directory is
not created it will be done so at this point. Note that older versions of <code>meson</code>
could run without any <em>command</em> argument, this is now deprecated.</p>
<p>There is only one restriction regarding the location of the <code>build_directory</code>:
it can't be the same as the source directory (i.e. where you cloned your module).
It can be outside of that directory or below/within that directory though.</p>
<p>Once meson is done configuring, you can either:</p>
<ol>
<li>
<p>enter the specified build directory and run ninja.</p>
<pre><code class="language-shell">cd &lt;build_directory&gt;
ninja
</code></pre>
</li>
<li>
<p><em>or</em> instead of switching to the build directory every time you wish to
execute <code>ninja</code> commands, you can just specify the build directory as an
argument. The advantage of this option is that you can run it from anywhere
(instead of changing to the ninja directory)</p>
<pre><code class="language-shell">ninja -C &lt;/path/to/build_directory&gt;
</code></pre>
</li>
</ol>
<p>This will build everything from that module (and subprojects if building
gst-build or the mono repository).</p>
<p>Note: You do not need to re-run <code>meson</code> when you modify source files, you just
need to re-run <code>ninja</code>. If you build/configuration files changed, <code>ninja</code> will
figure out on its own that <code>meson</code> needs to be re-run and will do that
automatically.</p>
<h2 id="entering-the-development-environment">Entering the development environment</h2>
<p>GStreamer is made of several tools, plugins and components. In order to make it
easier for development and testing, there is a target (provided by <code>gst-build</code>
or the mono repository, and in future directly by <code>meson</code> itself) which will
setup environment variables accordingly so that you can use all the
build results directly.</p>
<p>For anyone familiar with python and virtualenv, you will feel right at home.</p>
<p>The script is called <strong><code>gst-env.py</code></strong>, it is located in the root of the
GStreamer mono-repository.</p>
<p>Another way to enter the virtual environment is to execute <strong><code>ninja -C &lt;path/to/build_directory&gt; devenv</code></strong>. This option has less options and is
therefore not compatible with some workflows.</p>
<p><em>NOTE</em>: you cannot use <code>meson</code> or reconfigure with <code>ninja</code> within the virtual
environment, therefore build before entering the environment or build from
another terminal/terminal-tab.</p>
<h3 id="how-does-it-work">How does it work?</h3>
<p>Start a new shell session with a specific set of environment variables, that
tell GStreamer where to find plugins or libraries.</p>
<p>The most important options are:</p>
<ul>
<li>
<strong>Shell context related variables</strong>
<ul>
<li>
<em>PATH</em> - System path used to search for executable files, <code>gst-env</code> will
append folders containing executables from the build directory.</li>
<li>
<em>GST_PLUGIN_PATH</em> - List of paths to search for plugins (<code>.so</code>/<code>.dll</code>
files), <code>gst-env</code> will add all plugins found within the
<code>GstPluginsPath.json</code> file and from a few other locations.</li>
<li>
<em>GST_PLUGIN_SYSTEM_PATH</em>  - When set this will make GStreamer check for
plugins in system wide paths, this is kept blank on purpose by <code>gst-env</code> to
avoid using plugins installed outside the environment.</li>
<li>
<em>GST_REGISTRY</em> - Use a custom file as plugin cache / registry. <code>gst-env</code>
utilizes the one found in the given build directory.</li>
</ul>
</li>
<li>
<strong>Meson (build environment) related variables</strong>
<ul>
<li>
<em>GST_VERSION</em> - Sets the build version in meson.</li>
<li>
<em>GST_ENV</em> - Makes sure that neither meson or ninja are run from within the
<code>gst-env</code>. Can be used to identify if the environment is active.</li>
</ul>
</li>
<li>
<strong>Validation (test runners) related variables</strong>
<ul>
<li>
<em>GST_VALIDATE_SCENARIOS_PATH</em> - List of paths to search for validation
scenario files (list of actions to be executed by the pipeline). By default
<code>gst-env</code> will use all scenarious found in the
<code>prefix/share/gstreamer-1.0/validate/scenarios</code> directory within the parent
directory of <code>gst-env.py</code>.</li>
<li>
<em>GST_VALIDATE_PLUGIN_PATH</em> - List of paths to search for plugin files to
add to the plugin registry. The default search path is in the given build
directory under <code>subprojects/gst-devtools/validate/plugins</code>.</li>
</ul>
</li>
</ul>
<p>The general idea is to set up the meson build directory, build the project and
the switch to the development environment with <code>gst-env</code>. This creates a
development environment in your shell, that provides a separate set of plugins
and tools.
To check if you are in the development environment run: <code>echo $GST_ENV</code>, which will be set by <code>gst_env</code> to <code>gst-$GST_VERSION</code>.</p>
<p>You will notice the prompt changed accordingly. You can then run any GStreamer
tool you just built directly (like <code>gst-inspect-1.0</code>, <code>gst-launch-1.0</code>, ...).</p>
<h3 id="options-gstenv">Options <code>gst-env</code>
</h3>
<ul>
<li>
<p><strong>builddir</strong></p>
<ul>
<li>By default, the script will try to find the build directory within the
<code>build</code> or <code>builddir</code> directory within the same folder where
<code>gst-env.py</code> are located. This option allows to specify
a different location. This might be useful when you have multiple different
builds but you don't want to jump between folders.</li>
</ul>
</li>
<li>
<p><strong>srcdir</strong></p>
<ul>
<li>The parent folder of <code>gst-env.py</code> is used by default.
This option is used to get the current branch of the repository, to fetch
GstValidate plugins and for gdb.</li>
</ul>
</li>
<li>
<p><strong>sysroot</strong></p>
<ul>
<li>Useful if the project was cross-compiled on another machine and mounted via
a network file system/ssh file system/etc. Adjusts the paths (e.g. the
paths found in <em>GST_PLUGIN_PATH</em>) by removing the front part of the path
which matches <em>sysroot</em>.</li>
</ul>
<p><sub>For example if your rootfs is at /srv/rootfs, then the v4l2codecs plugin
might be built at
<code>/srv/rootfs/home/user/gstreamer/build/subprojects/gst-plugins-bad/sys/v4l2codecs</code>.
By executing <code>gst-env.py --sysroot /srv/rootfs</code> the path will be stored
within <em>GST_PLUGIN_PATH</em> as:
<code>/home/user/gstreamer/build/subprojects/gst-plugins-bad/sys/v4l2codecs</code>.</sub></p>
</li>
<li>
<p><strong>wine</strong></p>
<ul>
<li>Extend the GST_VERSION environment variable with a specific wine command</li>
</ul>
</li>
<li>
<p><strong>winepath</strong></p>
<ul>
<li>Add additional elements to the WINEPATH variable for wine environments.</li>
</ul>
</li>
<li>
<p><strong>only-environment</strong></p>
<ul>
<li>Instead of opening a new shell environment, print the environment variables
that would be used.</li>
</ul>
</li>
</ul>
<h3 id="use-cases">Use cases</h3>
<h4 id="setting-up-a-development-environment-while-keeping-the-distribution-package">Setting up a development environment while keeping the distribution package</h4>
<p>This case is very simple all you have to do is either:</p>
<ul>
<li>
<code>./gst-env.py</code> from the project root</li>
<li>
<code>ninja -C build devenv</code> (build is the generated meson build directory)</li>
<li>
<code>meson devenv</code> from the meson build directory (e.g. <code>build</code>) within the
project root</li>
</ul>
<h4 id="using-gstreamer-as-sub-project-to-another-project">Using GStreamer as sub project to another project</h4>
<p>This case is very similar to the previous, the only important deviation is that
the file system structure is important. <strong><code>gst-env</code></strong> will look for a
<code>GstPluginPaths.json</code> file either within the meson build directory (e.g.
<code>build</code>) or within <code>build/subprojects/gstreamer</code>.</p>
<h4 id="crosscompiling-in-combination-with-a-network-share">Cross-compiling in combination with a network share</h4>
<p>For cross compiling in general take a look at the <a href="https://mesonbuild.com/Cross-compilation.html">meson
documentation</a> or at projects
like <a href="https://gitlab.collabora.com/collabora/gst-build-sdk">gst-build-sdk</a>.</p>
<p>The basic idea is to prepare a rootfs on the cross compile host, that is
similar to that of target machine, prepare a
<a href="https://mesonbuild.com/Cross-compilation.html#defining-the-environment">cross-file.txt</a>,
build the project and export it via a <a href="https://wiki.archlinux.org/title/NFS">NFS mount/NFS
rootfs</a>/<a href="https://wiki.archlinux.org/title/SSHFS">SSHFS</a>/<a href="https://wiki.archlinux.org/title/Syncthing">Syncthing</a>
etc.</p>
<p>On the target machine you then have to remove the path to the rootfs on the
build machine from the GStreamer paths:</p>
<ul>
<li><code>./gst-env.py --sysroot /path/to/rootfs-on-cross-compile-host</code></li>
</ul>
<h2 id="working-with-multiple-branches-or-remotes">Working with multiple branches or remotes</h2>
<p>It is not uncommon to track multiple git remote repositories (such as the
official upstream repositories and your personal clone on gitlab).</p>
<p>In the gstreamer mono repository, just add your personal git remotes as you
would do with any other git repository, e.g.:</p>
<pre><code class="language-shell">git remote add personal git@gitlab.freedesktop.org:awesomehacker/gstreamer.git
git fetch
</code></pre>
<p>In gst-build (for 1.16/1.18 branches), you can add your personal
git remotes in the relevant subproject directory (and that would have to be
done for each subproject of interest, since the old 1.16/1.18 branches live in
separate git repositories), e.g.:</p>
<pre><code class="language-shell">cd subprojects/gstreamer/
git remote add personal git@gitlab.freedesktop.org:awesomehacker/gstreamer.git
git fetch
</code></pre>
<h2 id="configuration">Configuration</h2>
<p>You can list all the available options of a <code>meson</code> project by using the
configure command:</p>
<pre><code class="language-shell">meson configure
</code></pre>
<p>If you have an already configured build directory, you can provide that and you
will additionally get the configured values for that build:</p>
<pre><code class="language-shell">meson configure &lt;build-directory&gt;
</code></pre>
<p>That command will list for each option:</p>
<ul>
<li>The name of the option</li>
<li>The default (or configured) value of the option</li>
<li>The possible values</li>
<li>The description of that option</li>
</ul>
<blockquote>
<p>The values with <code>auto</code> mean that <code>meson</code> will figure out at configuration time
the proper value (for example, if you have the available development packages
to build a certain plugin).</p>
<p>You will also see values with <code>&lt;inherited from main project&gt;</code>. This is mostly
used for options which are generic options. For example the <code>doc</code> option is
present at the top-level, and also on every submodules (ex:
<code>gstreamer:doc</code>). Generally you only want to set the value of that option
once, and all submodules will inherit from that.</p>
</blockquote>
<p>You can then provide those options to <code>meson</code> when configuring the build with
<code>-D&lt;option_name&gt;=&lt;option_value&gt;</code>. For example, if one does not want to build the
rust plugins in <code>gst-build</code> (<code>rs</code> option), you would do:</p>
<pre><code class="language-shell">meson -Drs=disabled &lt;build-directory&gt;
</code></pre>
<p>You can also peek at the <code>meson_options.txt</code> files and <code>subproject/xyz/meson_options.txt</code>
files which is where the various project specific build options are listed.
These do not include all the standard Meson options however.</p>
<h2 id="running-tests">Running tests</h2>
<p>Running the unit tests is done by calling <code>meson test</code> from the build directory,
or <code>meson test -C &lt;path/to/build_directory&gt;</code>. If there are any failures you can
have a look at the file specified at the end or you can run <code>meson test --print-errorlogs</code> which will show you the logs of the failing test after
execution.</p>
<p>You can also execute just a subset of tests by specifying the name name. For
example <code>meson test gst_gstpad</code>. The complete list of tests is available with
<code>meson test --list</code>.</p>
<p>If the <code>gst-devtools</code> submodule is built, you can also use
<code>gst-validate-launcher</code><a href="https://gstreamer.freedesktop.org/documentation/gst-devtools/">gst-validate</a> for running tests.</p>
<pre><code class="language-shell">gst-validate-launcher check.gst*
</code></pre>
<h2 id="going-further">Going further</h2>
<p>More details are available in the <a href="https://gitlab.freedesktop.org/gstreamer/gstreamer/-/blob/main/README.md">GStreamer mono repo README</a>
or (for the older 1.16/1.18 branches) in the <a href="https://gitlab.freedesktop.org/gstreamer/gst-build/blob/master/README.md">gst-build documentation</a>.</p>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    
        
<div class="copyrights-description">
		<p>
				© 								2020, 
													       	Edward Hervey 				(<a href="mailto:edward@centricular.com">edward@centricular.com</a>)
			</p>
	</div>


	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://gitlab.freedesktop.org/gstreamer/gst-docs//edit/master/subprojects/gst-docs/markdown/installing/building-from-source-using-meson.md" data-hotdoc-role="edit-button">Edit on GitLab</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
