fragment_downloaded_cb({"url":"additional/design/dmabuf.html#example","fragment":"Example\nConsider the pipeline of:\nboth vapostproc and glupload work on the same GPU. (DMABuf caps filter\nis just for illustration, it doesn't need to be specified, since DMA\nnegotiation is well supported.)\nThe VA-API based vapostproc element can detect the modifiers at the\nelement registration time and the src template should be:\nWhile glupload needs the runtime EGL context to check the DRM fourcc and\nmodifiers, so it can just leave the drm-format field absent in its sink\ntemplate:\nAt runtime, when the vapostproc wants to decide its src caps, it first\nquery the downstream glupload element about all possible DMA caps. The\nglupload should answer that query based on the GL/EGL query result, such\nas:\nSo, the intersection with vapostproc's src caps will be\nNV12:0x0100000000000001. It will be the sent to downstream (glupload)\nby a CAPS event. The vapostproc element may also query the allocation\nafter that CAPS event, but downstream glupload will not provide a DMA\nbuffer pool because EGL API is mostly for DMAbuf importing. Then\nvapostproc will create its own DMA pool, the buffers created from that\nnew pool should conform drm-format, described in this document, with\nNV12:0x0100000000000001. Also, the downstream glupload should make sure\nthat it can import other DMA buffers which are not created in the pool it\nprovided, as long as they conform with drm-format\nNV12:0x0100000000000001.\nThen, when vapostproc handles each frame, it creates GPU surfaces with\ndrm-format NV12:0x0100000000000001. Each surface is also exported as a\nset of file descriptors, each one wrapped in GstMemory allocated by a\nsubclass of GstDmaBufAllocator. All the GstMemory are appended to a\nGstBuffer. There may be some extra information about the pitch, stride\nand plane offset when we export the surface, we also need to translate them\ninto GstVideoMeta and attached it to the GstBuffer.\nLater glupload, when it receives a GstBuffer, it can use those file\ndescriptors with drm-format NV12:0x0100000000000001 to import an\nEGLImage. If the GstVideoMeta exists, this extra parameters should also\nbe provided to the importing API.\n"});