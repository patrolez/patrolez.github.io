<!DOCTYPE html>
<html lang="en">
<head>

<base href="..">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Validate Flow</title>

<link rel="stylesheet" href="assets/css/dark-frontend.css" type="text/css" title="dark">
<link rel="alternate stylesheet" href="assets/css/light-frontend.css" type="text/css" title="light">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/extra_frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/devhelp.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css" title="dark">

<link rel="alternate stylesheet" href="assets/css/prism.css" type="text/css" title="light">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>
<script src="assets/js/styleswitcher.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/trie.js"></script>

<!-- generic -->
<link rel="icon" type="image/png" href="assets/images/favicon-16.png" sizes="16x16">
<link rel="icon" type="image/png" href="assets/images/favicon-32.png" sizes="32x32">
<link rel="icon" type="image/png" href="assets/images/favicon-57.png" sizes="57x57">
<link rel="icon" type="image/png" href="assets/images/favicon-64.png" sizes="64x64">
<link rel="icon" type="image/png" href="assets/images/favicon-76.png" sizes="76x76">
<link rel="icon" type="image/png" href="assets/images/favicon-96.png" sizes="96x96">
<link rel="icon" type="image/png" href="assets/images/favicon-128.png" sizes="128x128">
<link rel="icon" type="image/png" href="assets/images/favicon-192.png" sizes="192x192">
<link rel="icon" type="image/png" href="assets/images/favicon-228.png" sizes="228x228">

<!-- Android -->
<link rel="shortcut icon" sizes="196x196" href="assets/images/favicon-196.png">

<!-- iOS -->
<link rel="apple-touch-icon" href="assets/images/favicon-120.png" sizes="120x120">
<link rel="apple-touch-icon" href="assets/images/favicon-152.png" sizes="152x152">
<link rel="apple-touch-icon" href="assets/images/favicon-180.png" sizes="180x180">

</head>

<body class="no-script
">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<span title="light mode switch" class="glyphicon glyphicon-sunglasses pull-right" id="lightmode-icon"></span>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/gstreamer-logo.svg" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
    <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        API References<span class="caret"></span>
    </a>
	<ul class="dropdown-menu" id="modules-menu">
					<li>
				<a href="gstreamer/gi-index.html">GStreamer core</a>
			</li>
					<li>
				<a href="libs.html">GStreamer Libraries</a>
			</li>
					<li>
				<a href="plugins_doc.html">GStreamer Plugins</a>
			</li>
		</ul>
</li>

<li>
    <a href="application-development/index.html">Application manual</a>
</li>


<li>
    <a href="tutorials/index.html">Tutorials</a>
</li>

			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
							</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="False" data-hotdoc-project="gst-devtools" data-hotdoc-ref="gst-validate-flow.html" class="page_container" id="page-wrapper" data-hotdoc-meta-gi-languages="['c', 'javascript', 'python']">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/full-width.js"></script>
  <div id="sitenav-wrapper">
    <iframe src="hotdoc-sitemap.html" id="sitenav-frame"></iframe>
  </div>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="validate-flow">Validate Flow</h1>
<p>Validate Flow â€” GStreamer validate component to record a log of buffers and
events flowing in a specified pad and compare it with an expectation file.</p>
<h2 id="description">Description</h2>
<p>This component exists for the purpose of testing non-regular-playback use cases
where the test author specifies the full pipeline, a series of actions and needs
to check whether the generated buffers and events make sense.</p>
<p>The testing procedure goes like this:</p>
<ol>
<li>
<p>The test author writes a <a href="gst-devtools/gst-validate-test-file.html">.validatetest</a> test
where validateflow is used. A pad where monitoring will occur is specified
and possibly a list of <a href="gst-devtools/gst-validate-action-types.html">actions</a> to run can
also be specified.</p>
</li>
<li>
<p>The test author runs the test with the desired pipeline, the configuration
and the actions. Since an expectation file does not exist at
this point, validateflow will create one. The author should check its
contents for any missing or unwanted events. No actual checking is done by
validateflow in this step, since there is nothing to compare to yet.</p>
</li>
<li>
<p>Further executions of the test will also record the produced buffers and
events, but now they will be compared to the previous log (expectation file).
Any difference will be reported as a test failure. The original expectation
file is never modified by validateflow. Any desired changes can be made by
editing the file manually or deleting it and running the test again.</p>
</li>
</ol>
<h2 id="example">Example</h2>
<h3 id="simplest-example">Simplest example</h3>
<p>The following is an example of a <code>fakesrc.simple.validatetest</code> file using
validateflow.</p>
<pre><code class="language-ini">meta,
    args = {
         "fakesrc num-buffers=1 ! fakesink name=sink",
    },
    configs = {
       "$(validateflow), pad=sink:sink, buffers-checksum=true",
    }
# The validate tool will simply play the pipeline until EOS is reached.
</code></pre>
<p>Then generate the expectation file with:</p>
<pre><code class="language-bash">gst-validate-1.0 --set-test-file /path/to/fakesrc.simple.validatetest
</code></pre>
<p>This will generate the
<code>/path/to/fakesrc.simple/flow-expectations/log-sink-sink-expected</code> file
containing:</p>
<p>{{ plugins/fakesrc.simple/flow-expectations/log-sink-sink-expected.log }}</p>
<p>Note that the test will be marked as "SKIPPED" when we generate expectation
files.</p>
<p>The test can now be run with:</p>
<pre><code>gst-validate-1.0 --set-test-file /path/to/fakesrc.simple.validatetest
</code></pre>
<h3 id="example-controlling-the-source">Example controlling the source</h3>
<p>The following is an example of the <code>qtdemux_change_edit_list.validatetest</code> file using validateflow.</p>
<pre><code class="language-ini">set-globals, media_dir="$(test_dir)/../../../medias/"
meta,
    seek=false,
    handles-states=false,
    args = {
         "appsrc ! qtdemux ! fakesink async=false",
    },
    configs = {
       "$(validateflow), pad=fakesink0:sink, record-buffers=false",
    }

# Scenario action types
appsrc-push, target-element-name=appsrc0, file-name="$(media_dir)/fragments/car-20120827-85.mp4/init.mp4"
appsrc-push, target-element-name=appsrc0, file-name="$(media_dir)/fragments/car-20120827-85.mp4/media1.mp4"
checkpoint, text="A moov with a different edit list is now pushed"
appsrc-push, target-element-name=appsrc0, file-name="$(media_dir)/fragments/car-20120827-86.mp4/init.mp4"
appsrc-push, target-element-name=appsrc0, file-name="$(media_dir)/fragments/car-20120827-86.mp4/media2.mp4"
stop
</code></pre>
<p>This example shows the elements of a typical validate flow test (a pipeline, a
config and a scenario). Some actions typically used together with validateflow
can also be seen. Notice variable interpolation is used to fill absolute paths
for media files in the scenario (<code>$(test_dir)</code>). In the configuration,
<code>$(validateflow)</code> is expanded to something like this, containing proper paths
for expectations and actual results (these values are interpolated from the
<code>.validatetest</code> file location):</p>
<pre><code class="language-ini">validateflow, expectations-dir="/validate/test/file/path/validateqtdemux_change_edit_list/flow-expectations/", actual-results-dir="$(GST_VALIDATE_LOGSDIR)/logs/validate/launch_pipeline/qtdemux_change_edit_list"
</code></pre>
<p>The resulting log looks like this:</p>
<pre><code class="language-ini">event stream-start: GstEventStreamStart, flags=(GstStreamFlags)GST_STREAM_FLAG_NONE, group-id=(uint)1;
event caps: video/x-h264, stream-format=(string)avc, alignment=(string)au, level=(string)2.1, profile=(string)main, codec_data=(buffer)014d4015ffe10016674d4015d901b1fe4e1000003e90000bb800f162e48001000468eb8f20, width=(int)426, height=(int)240, pixel-aspect-ratio=(fraction)1/1;
event segment: format=TIME, start=0:00:00.000000000, offset=0:00:00.000000000, stop=none, time=0:00:00.000000000, base=0:00:00.000000000, position=0:00:00.000000000
event tag: GstTagList-stream, taglist=(taglist)"taglist\,\ video-codec\=\(string\)\"H.264\\\ /\\\ AVC\"\;";
event tag: GstTagList-global, taglist=(taglist)"taglist\,\ datetime\=\(datetime\)2012-08-27T01:00:50Z\,\ container-format\=\(string\)\"ISO\\\ fMP4\"\;";
event tag: GstTagList-stream, taglist=(taglist)"taglist\,\ video-codec\=\(string\)\"H.264\\\ /\\\ AVC\"\;";
event caps: video/x-h264, stream-format=(string)avc, alignment=(string)au, level=(string)2.1, profile=(string)main, codec_data=(buffer)014d4015ffe10016674d4015d901b1fe4e1000003e90000bb800f162e48001000468eb8f20, width=(int)426, height=(int)240, pixel-aspect-ratio=(fraction)1/1, framerate=(fraction)24000/1001;

CHECKPOINT: A moov with a different edit list is now pushed

event caps: video/x-h264, stream-format=(string)avc, alignment=(string)au, level=(string)3, profile=(string)main, codec_data=(buffer)014d401effe10016674d401ee8805017fcb0800001f480005dc0078b168901000468ebaf20, width=(int)640, height=(int)360, pixel-aspect-ratio=(fraction)1/1;
event segment: format=TIME, start=0:00:00.041711111, offset=0:00:00.000000000, stop=none, time=0:00:00.000000000, base=0:00:00.000000000, position=0:00:00.041711111
event tag: GstTagList-stream, taglist=(taglist)"taglist\,\ video-codec\=\(string\)\"H.264\\\ /\\\ AVC\"\;";
event tag: GstTagList-stream, taglist=(taglist)"taglist\,\ video-codec\=\(string\)\"H.264\\\ /\\\ AVC\"\;";
event caps: video/x-h264, stream-format=(string)avc, alignment=(string)au, level=(string)3, profile=(string)main, codec_data=(buffer)014d401effe10016674d401ee8805017fcb0800001f480005dc0078b168901000468ebaf20, width=(int)640, height=(int)360, pixel-aspect-ratio=(fraction)1/1, framerate=(fraction)24000/1001;
</code></pre>
<h2 id="configuration">Configuration</h2>
<p>In order to use the plugin a validate configuration must be provided,
containing a line starting by <code>validateflow</code> followed by a number of settings.
Every <code>validateflow</code> line creates a <code>ValidateFlowOverride</code>, which listens to a
given pad. A test may have several <code>validateflow</code> lines, therefore having
several overrides and listening to different pads with different settings.</p>
<ul>
<li>
<code>pad</code>: Required. Name of the pad that will be monitored.</li>
<li>
<code>record-buffers</code>: Default: false. Whether buffers will be logged. By default
only events are logged.</li>
<li>
<code>buffers-checksum</code>: Default: 'none'. Define the type of checksums to be used
valid values are:
<ul>
<li>
<code>none</code>: No checksum recorded</li>
<li>
<code>as-id</code>: Record checksum as 'ids' where the IDs are incremented on each new
checksum passed in</li>
<li>
<code>md5</code>: md5 checksum</li>
<li>
<code>sha1</code>: sha1 checksum</li>
<li>
<code>sha256</code>: sha256 checksum</li>
<li>
<code>sha512</code>: sha512 checksum</li>
<li>
<em>Note</em>: for backward compatibility reasons, this can be passed as a
boolean and it will default to 'sha1' if true, 'none' if false.</li>
</ul>
</li>
<li>
<code>ignored-fields</code>: Default: <code>"stream-start={ stream-id }"</code> (as they are often
non reproducible). Key with a serialized GstValueList(str) of fields to not
record.</li>
<li>
<code>logged-fields</code>: Default: <code>NULL</code> Key with a serialized GstValueList(str) of
fields to record, eg. <code>logged-event-fields="stream-start={flags}, caps={width, height, framerate}, buffer={pts}"</code>. Overrides
<code>ignored-event-fields</code> for specified event types.</li>
<li>
<code>ignored-event-types</code>: Default: <code>{ }</code>. List of event type names to not record</li>
<li>
<code>logged-event-types</code>: Default: <code>NULL</code>. List of event type names to not record,
if noone provided, all events are logged, except the ones defined in the
<code>ignored-event-types</code>.</li>
<li>
<code>expectations-dir</code>: Path to the directory where the expectations will be
written if they don't exist, relative to the current working directory. By
default the current working directory is used, but this setting is usually
set automatically as part of the <code>%(validateflow)s</code> expansion to a correct
path like <code>~/gst-validate/gst-integration-testsuites/flow-expectations/&lt;test name&gt;</code>.</li>
<li>
<code>actual-results-dir</code>: Path to the directory where the events will be recorded.
The expectation file will be compared to this. By default the current working
directory is used, but this setting is usually set automatically as part of
the <code>%(validateflow)s</code> expansion to the test log directory, i.e.
<code>~/gst-validate/logs/validate/launch_pipeline/&lt;test name&gt;</code>.</li>
<li>
<code>generate-expectations</code>: Default: unset. When set to <code>true</code> the expectation
file will be written and no testing will be done and if set to <code>false</code>, the
expectation file will be required. If a validateflow config is used without
specifying any other parametters, the validateflow plugin will consider that
all validateflow overrides will use that value.</li>
</ul>
<h2 id="scenario-actions">Scenario actions</h2>
<p>Scenarios with validateflow work in the same way as other tests. Often
validatetests will use appsrc in order to control the flow of data precisely,
possibly interleaving events in between. The following is a list of useful
actions.</p>
<ul>
<li>
<code>appsrc-push</code>: Pushes a buffer from an appsrc element and waits for the chain
operation to finish. A path to a file is provided, optionally with an offset
and/or size.</li>
<li>
<code>appsrc-eos</code>: Queues an EOS event from the appsrc. The action finishes
immediately at this point.</li>
<li>
<code>stop</code>: Tears down the pipeline and stops the test.</li>
<li>
<code>checkpoint</code>: Records a "checkpoint" message in all validateflow overrides,
with an optional explanation message. This is useful to check certain events
or buffers are sent at a specific moment in the scenario, and can also help
to the comprehension of the scenario.</li>
</ul>
<p>More details on these actions can be queried from the command line, like this:</p>
<pre><code class="language-bash">gst-validate-1.0 --inspect-action-type appsrc-push
</code></pre>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    

	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
